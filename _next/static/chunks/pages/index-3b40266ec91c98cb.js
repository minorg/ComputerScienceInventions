(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5330:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.LunrWorkQueryService=void 0;const o=n(5578),i=r(n(8437)),s=r(n(4672)),a=n(8166)("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");class l{constructor(t){this.configuration=t.configuration,this.dataset=t.dataset,this.index=(0,i.default)((function(){var e;this.field("abstract"),this.field("title");const n={},r=null!==(e=t.configuration.workProperties)&&void 0!==e?e:[];for(const t of r){if(!t.searchable)continue;const e=t.uri,r=l.encodeFieldName(e);n[e]=r,this.field(r)}this.ref("uri");for(const o of t.dataset.works){const t={title:o.title,uri:o.uri};o.abstract&&(t.abstract=o.abstract.toString());for(const e of r){const r=n[e.uri];if(r)for(const n of o.propertyValues(e.uri))t[r]=n.value}this.add(t)}}))}static encodeFieldName(t){return a.encode((new TextEncoder).encode(t))}facetizeWorks(t){const{filters:e,valueFacetValueThumbnailSelector:n,works:r}=t,o=[];for(const i of e)switch(i.type){case"CollectionValue":{const t={};let e=0;for(const o of r){o.collectionUris&&0!==o.collectionUris.length||e++;for(const e of o.collectionUris){const r=t[e];if(r)r.count++;else{const r=this.dataset.collectionByUri(e);t[e]={count:1,label:r.title,thumbnail:n?l.toValueFacetValueThumbnail(r.thumbnail(n)):null,value:e}}}}const i={type:"CollectionValue",unknownCount:e,values:Object.keys(t).map((e=>t[e]))};o.push(i);break}case"InstitutionValue":{const t={};for(const o of r){const e=t[o.institutionUri];if(e)e.count++;else{const e=this.dataset.institutionByUri(o.institutionUri);t[o.institutionUri]={count:1,label:e.name,thumbnail:n?l.toValueFacetValueThumbnail(e.thumbnail(n)):null,value:o.institutionUri}}}const e={type:"InstitutionValue",unknownCount:0,values:Object.keys(t).map((e=>t[e]))};o.push(e);break}case"StringPropertyValue":{const t=i;let e=0;const s={};for(const o of r){let r=!1;for(const e of o.propertyValues(t.propertyUri)){const t=e.value,o=s[t];o?o.count++:s[t]={count:1,label:e.label,value:t,thumbnail:n?l.toValueFacetValueThumbnail(e.thumbnail(n)):null},r=!0}r||e++}const a={propertyUri:t.propertyUri,type:"StringPropertyValue",unknownCount:e,values:Object.keys(s).map((t=>s[t]))};o.push(a);break}}return o}filterWorks(t){const{filters:e,works:n}=t;let r=n;for(const o of e)switch(o.type){case"CollectionValue":r=r.filter((t=>l.testValueFilter(o,t.collectionUris)));break;case"InstitutionValue":r=r.filter((t=>l.testValueFilter(o,[t.institutionUri])));break;case"StringPropertyValue":r=r.filter((t=>l.testValueFilter(o,t.propertyValues(o.propertyUri).map((t=>t.value)))))}return r}getWorkAgents(t,e){const{agentJoinSelector:n,limit:r,offset:i}=t;return(0,s.default)(!!e,"query must be defined"),(0,s.default)(r>0,"limit must be > 0"),(0,s.default)(i>=0,"offset must be >= 0"),new Promise((t=>{const s=this.filterWorks({filters:e.filters,works:this.searchWorks(e)}),a={};for(const e of s)for(const t of e.agents)a[t.agent.uri]||(a[t.agent.uri]=t.agent);const l=Object.keys(a).map((t=>a[t])).sort(((t,e)=>t.name.localeCompare(e.name))),u=l.slice(i,i+r);t({dataset:new o.DataSubsetter({completeDataset:this.dataset,configuration:this.configuration}).agentsDataset(u,n),totalWorkAgentsCount:l.length,workAgentUris:u.map((t=>t.uri))})}))}getWorks(t,e){const{limit:n,offset:r,valueFacetValueThumbnailSelector:i,workJoinSelector:a}=t;return(0,s.default)(!!e,"query must be defined"),(0,s.default)(n>0,"limit must be > 0"),(0,s.default)(r>=0,"offset must be >= 0"),new Promise((t=>{const s=this.searchWorks(e),l=this.facetizeWorks({filters:e.filters,valueFacetValueThumbnailSelector:i,works:s}),u=this.filterWorks({filters:e.filters,works:s});console.debug("Search filtered works count:",u.length);const c=u.slice(r,r+n);console.debug("Search sliced works count:",c.length);const f=new o.DataSubsetter({completeDataset:this.dataset,configuration:this.configuration}).worksDataset(c,a);console.debug("Search results dataset:",Object.keys(f).map((t=>`${t}: ${f[t].length}`)).join(", ")),t({dataset:f,facets:l,totalWorksCount:u.length})}))}searchWorks(t){return t.text?this.index.search(t.text).map((({ref:t})=>this.dataset.workByUri(t))):this.dataset.works}static testValueFilter(t,e){var n,r;if(0===e.length&&t.excludeUnknown)return!1;const o=null!==(n=t.excludeValues)&&void 0!==n?n:[],i=null!==(r=t.includeValues)&&void 0!==r?r:[];if(0===o.length&&0===i.length)return!0;if(o.length>0)for(const s of e)if(o.some((t=>t===s)))return!1;if(i.length>0){let t=!1;for(const n of e)if(i.some((t=>t===n))){t=!0;break}if(!t)return!1}return!0}static toValueFacetValueThumbnail(t){var e,n,r,o;if(!t)return null;const i=t.src;if(!i)return null;const s=t.rights;return{exactDimensions:t.exactDimensions,maxDimensions:t.maxDimensions,rights:s?{creators:s.creators.map((t=>t.toString())),holders:s.holders.map((t=>t.toString())),license:null!==(n=null===(e=s.license)||void 0===e?void 0:e.toString())&&void 0!==n?n:null,statement:null!==(o=null===(r=s.statement)||void 0===r?void 0:r.toString())&&void 0!==o?o:null}:null,src:i}}getWorkEvents(t,e){const{limit:n,offset:r,requireDate:i,workEventJoinSelector:a}=t;return(0,s.default)(!!e,"query must be defined"),(0,s.default)(n>0,"limit must be > 0"),(0,s.default)(r>=0,"offset must be >= 0"),new Promise((t=>{const s=this.filterWorks({filters:e.filters,works:this.searchWorks(e)}).flatMap((t=>t.events.filter((t=>!i||null!==t.sortDate)))).sort(((t,e)=>t.compareByDate(e))),l=s.slice(r,r+n);t({dataset:new o.DataSubsetter({completeDataset:this.dataset,configuration:this.configuration}).workEventsDataset(s,a),totalWorkEventsCount:s.length,workEventUris:l.map((t=>t.uri))})}))}getWorkLocations(t,e){return(0,s.default)(!!e,"query must be defined"),new Promise((t=>{t({workLocations:this.filterWorks({filters:e.filters,works:this.searchWorks(e)}).flatMap((t=>t.locations.map((e=>({location:{lat:e.location.lat,long:e.location.long},role:e.role,title:e.title,work:{title:t.title,uri:t.uri}})))))})}))}}e.LunrWorkQueryService=l},3753:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),o=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),o(n(5330),e)},3255:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(4796)}])},4796:function(t,e,n){"use strict";n.r(e),n.d(e,{__N_SSG:function(){return p}});var r=n(2322),o=n(2784),i=n(5578),s=n(6627),a=n(2304),l=n(3241),u=n(9097),c=n(3753),f=n(4671);n(680);function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){d(t,e,n[e])}))}return t}function m(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var b=(0,n(5237).default)((function(){return Promise.all([n.e(164),n.e(381)]).then(n.bind(n,3381)).then((function(t){return t.WorkLocationsMap}))}),{loadableGenerated:{webpack:function(){return[3381]},modules:["index.tsx -> ../components/WorkLocationsMap"]},ssr:!1}),p=!0;e.default=function(t){var e=t.collectionUri,n=t.configuration,d=t.datasetString,p=(0,o.useMemo)((function(){return i.Dataset.parse(d)}),[d]),k=(0,o.useMemo)((function(){return p.collectionByUri(e)}),[e,d]),g=(0,o.useMemo)((function(){return new c.LunrWorkQueryService({configuration:n,dataset:p})}),[n,p]),y=(0,f.useWorkSearchQueryParams)(n),v=y.onSearch,w=m(y,["onSearch"]);return(0,r.jsx)(s.A,{collection:k,configuration:n,onSearch:v,children:(0,r.jsx)(a.WorkSearchContainer,h({renderWorkLink:function(t,e){return(0,r.jsx)(u.default,{href:l.P.work(t),children:(0,r.jsx)("a",{children:e})})},workLocationsMapComponent:b,workQueryService:g},w))})}}},function(t){t.O(0,[774,890,66,90,425,573,627,888,179],(function(){return e=3255,t(t.s=e);var e}));var e=t.O();_N_E=e}]);